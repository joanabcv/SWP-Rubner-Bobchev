import random
from collections import Counter


def ziehe_karte(karten):
    gezogene = []
    for i in range(5):
        index = random.randint(0, len(karten) - 1 - i)
        gezogene_karte = karten[index]
        last_index = len(karten) - 1 - i
        karten[index], karten[last_index] = karten[last_index], gezogene_karte

        gezogene.append(gezogene_karte)

    return gezogene


def karte_eig(karten):
    farben = [karte % 4 for karte in karten]
    werte = [karte % 13 for karte in karten]
    return werte, farben


def pairs(werte):
    counts = Counter(werte)
    paare = [w for w, c in counts.items() if c >= 2]
    drilling = [w for w, c in counts.items() if c == 3]
    vierer = [w for w, c in counts.items() if c == 4]

    if len(vierer) == 1:
        return "four_of_a_kind"
    elif len(drilling) == 1 and len(paare) == 1:
        return "full_house"
    elif len(drilling) == 1:
        return "three_of_a_kind"
    elif len(paare) >= 2:
        return "two_pair"
    elif len(paare) == 1:
        return "pair"
    return None


def strasse(werte):
    unique_sorted = sorted(set(werte))
    count = 1

    for i in range(1, len(unique_sorted)):
        if unique_sorted[i] == unique_sorted[i - 1] + 1:
            count += 1
            if count >= 5:
                return True
        else:
            count = 1
    return False


def flush(farben):
    farb_counts = Counter(farben)
    for farbe, c in farb_counts.items():
        if c >= 5:
            return farbe
    return None


def straightflush(werte, farben):
    return strasse(werte) and flush(farben)


def fullhouse(werte):
    counts = Counter(werte)
    drilling = any(c == 3 for c in counts.values())
    paar = any(c == 2 for c in counts.values())
    return drilling and paar


def royalflush(werte, farben):
    royal = {10, 11, 12, 13, 14}
    return set(werte) == royal


def statistik(durchlaeufe):
    stats = {
        "pair": 0,
        "two_pair": 0,
        "three_of_a_kind": 0,
        "straight": 0,
        "flush": 0,
        "full_house": 0,
        "four_of_a_kind": 0,
        "straight_flush": 0,
        "royal_flush": 0,
    }

    for _ in range(durchlaeufe):
        deck = list(range(1, 53))
        gezogene = ziehe_karte(deck)
        werte, farben = karte_eig(gezogene)

        hand = pairs(werte)
        if hand in stats:
            stats[hand] += 1

        if strasse(werte):
            stats["straight"] += 1

        if flush(farben):
            stats["flush"] += 1

        if straightflush(werte, farben):
            stats["straight_flush"] += 1

        if royalflush(werte, farben):
            stats["royal_flush"] += 1

    print("\n=== Poker Statistik ===")
    for hand, count in stats.items():
        prozent = count / durchlaeufe * 100
        print(f"{hand:18}: {count} ({prozent:.2f}%)")

    return stats


def main():
    print("Poker Simulation")
    versuche = int(input("Wieviele Durchläufe sollen simuliert werden? "))4
    print(f"\nStarte Simulation mit {versuche:,} Durchläufen...\n")

    statistik(versuche)


if __name__ == "__main__":
    main()
